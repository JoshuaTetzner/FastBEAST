# Fast Multipole Method (FMM)

The FMM improves the complexity of the matrix-vector product

$$\mathbf{A} \mathbf{x}  = \mathbf{y}$$

form $\mathcal{O}(N²)$ to $\mathcal{O}(N)$, where $A$ is the interaction matrix of monopole or dipole sources that evaluates the Green's function for a Laplace, Helmholtz or modified Helmholtz kernel. The BEM on th other hand is an integral method. To apply the FMM on the integral expressions in the BEM, the internal structure of the FMM must be changed. A fast implementation of a FMM is quiet difficult to achieve, changing the internal structure of the FMM is therefore often cumbersome and results in bad performance. 

There a some highly optimized FMM codes such as the [ExaFMM](https://github.com/exafmm/exafmm-t) package for monopole and dipole interactions. To use such optimized algorithms with the BEM, Adelmann et al. present in [1] a black-box FMM approach. This method, called the error correction factor matrix method, approximates the BEM integrals by a quadrature. The  quadrature points are then treated as monopole or dipole source, which can directly plugged in to the FMM. The error generated by the quadrature is afterwards corrected. 

## Error Correction Factor Matrix Method
The method starts with discretizing the geometry. On each triangle the algorithm samples quadrature points which approximate the defined integral. This approximation is sufficient for well separated triangles. For triangles which are to close to each other the quadrature is not accurate and has to be corrected. To determine which triangles are well separated the geometry is clustered in a tree structure by any preferred clustering strategy. 

Given the close interactions and the far interactions, we can setup the black-box FMM. For the close interactions we have to solve the BEM integrals directly giving the matrix $\mathbf{S}$. Additionally we have to evaluate the Greens function for these points which is computed in the FMM and has to be corrected. This matrix is called the correction matrix $\mathbf{C}$. 
The FMM evaluates the interaction of points which are the quadrature points given a charge on each point. The charge is composed out of the vector $x$, the quadrature weight and the action of the test and trial functions on the weighted sums over the quadrature points. This is influence is described by the matrix $\mathbf{P}_1$ and $\mathbf{P}_2$. The  construction of these interaction matrices is discussed in detail later on. 
With these matrices the product $\mathbf{Ax}$ writes

$$\mathbf{A} \mathbf{x} = \mathbf{P}_2^T(\mathbf{G}-\mathbf{C})\mathbf{P_1}\mathbf{x} + \mathbf{S}\mathbf{x}$$


# References
[1] Adelman, Ross, Nail A. Gumerov, and Ramani Duraiswami. “FMM/GPU-Accelerated Boundary Element Method for Computational Magnetics and Electrostatics.” IEEE Transactions on Magnetics 53, no. 12 (December 2017): 1–11. https://doi.org/10.1109/TMAG.2017.2725951.